<!-- filepath: c:\Users\LENOVO\OneDrive\Documents\BYU Pathway\CSE340\CSE340-starter\views\partials\vehicle-reviews.ejs -->
<!-- Vehicle Reviews Partial -->

<% if (typeof reviews !== 'undefined' && reviews.length > 0) { %>
<section class="vehicle-reviews">
  <h2>Customer Reviews</h2>

  <!-- Average Rating Display -->
  <% if (typeof averageRating !== 'undefined' && averageRating.avg_rating) { %>
  <div class="average-rating">
    <div class="rating-display">
      <div class="stars">
        <% for (let i = 1; i <= 5; i++) { %>
          <span class="star <%= i <= Math.round(averageRating.avg_rating) ? 'filled' : '' %>">⭐</span>
        <% } %>
      </div>
      <span class="avg-rating-text"><%= Math.round(averageRating.avg_rating * 10) / 10 %>/5</span>
      <span class="review-count">(<%= averageRating.review_count %> review<%= averageRating.review_count !== 1 ? 's' : '' %>)</span>
    </div>
  </div>
  <% } %>

  <!-- Individual Reviews -->
  <div class="reviews-list">
    <% reviews.forEach(review => { %>
      <div class="review-item">
        <div class="review-header">
          <div class="reviewer-info">
            <span class="reviewer-name"><%= review.account_firstname %> <%= review.account_lastname %></span>
            <span class="review-date"><%= new Date(review.review_date).toLocaleDateString() %></span>
          </div>
          <div class="review-rating">
            <% for (let i = 1; i <= 5; i++) { %>
              <span class="star <%= i <= review.review_rating ? 'filled' : '' %>">⭐</span>
            <% } %>
          </div>
        </div>
        <div class="review-text">
          <p><%= review.review_text %></p>
        </div>
      </div>
    <% }) %>
  </div>

  <!-- Add Review Button (for logged-in users) -->
  <% if (typeof account_id !== 'undefined' && account_id) { %>
  <div class="review-actions">
    <a href="/reviews/add?inv_id=<%= inv_id %>" class="btn">Write a Review</a>
  </div>
  <% } %>
</section>
<% } %>
